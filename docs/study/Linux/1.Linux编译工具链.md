---
comments: true
---

## 1.1 Vim编辑器

Vim是从Vi发展出来的编辑器，具有代码补全、查找、快速跳转等功能。其中Vim共分为普通模式、输入模式、命令行模式，切换模式命令如下图。

![1](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/G7uRbLJ2Hosxqxxf28bcq3EfnEh.png)

### 1.1.1 普通模式

使用`vim <doc_name>`命令启动Vim后，默认进入普通模式。此模式下，不能直接输入文本内容，主要进行 **文本替换** 、 **文本查找** 、 **删除文字**  、 **复制粘贴** 等操作。

- 【切换模式】
  - `i`：在光标当前位置输入。
  - `a`：在光标后一个位置输入。
  - `o`：在光标所在行的下一行输入。
  - `:`：进入命令行模式。

> 进入命令行模式直接跟具体命令。
>

- 【光标移动】
  - `h`：光标向左移动一个字符。
  - `j`：光标向下移动一行。
  - `k`：光标向上移动一行。
  - `l`：光标向右移动一个字符。

> 实际上这四个键并不好用，我们可以使用上下左右四个键更直观一些。
>

- 【翻页】
  - `Ctrl + f`：向下翻页。
  - `Ctrl + b`：向上翻页。

> 翻页多用于浏览文本。
>

- 【删除】
  - `x`：删除光标所在位置的字符。
  - `dd`：删除光标所在的整行内容。
  - `dw`：删除从光标位置开始到单词末尾的字符。

> 键盘的Delete键与x键功能一致。
>

- 【撤销】
  - `u`：撤销上一次的操作。
  - `Ctrl + r`：重做上一次撤销的操作。

- 【复制粘贴】
  - `yy`：复制当前行。
  - `dd`：剪切当前行。
  - `p(小写)`：粘贴内容到光标的下方。
  - `P(大写)`：粘贴内容到光标的上方。

> 在`yy`前加上数字，可以复制多行，如`3yy`复制光标所在行开始的 3 行内容。`dd`既是删除，也可以实现剪切。
>

- 【查找】
  - `/`：查找字符串。
  - `n(小写)`：继续查找下一个匹配项。
  - `N(大写)`：继续查找上一个匹配项。

> 注意区分大小写，替换在命令行模式进行。
>

### 1.1.2 输入模式

在普通模式下，按下`i/a/o`键进入输入模式。此模式下，可以直接 **编辑文本内容** ，按下`Esc`键就能回到普通模式。

> 该模式无特殊命令，主要进行文本修改。
>

### 1.1.3 命令行模式

在普通模式下，按下`:`键进入命令行模式。此模式下，可以执行保存内容、退出Vim等操作，按下`Esc`键就能回到普通模式。

- 【保存与退出】
  - `:w`：保存文件。
  - `:q`：退出Vim。
  - `:q!`：强制退出 Vim，即使文件修改没有保存也会退出（慎用）。
  - `:wq`：保存文件，然后退出Vim。

- 【替换】
  - `:s/旧字符串/新字符串/g`：可以在当前行替换所有的旧字符串为新字符串。
  - `:%s/旧字符串/新字符串/g`：整个文件范围内替换。

> `:`是从普通模式进入命令行模式，后面直接跟命令，因此替换均是在命令行模式下进行的。

### 1.1.4 Vim使用练习

新建文件夹和 C 文件：

```shell
# 新建文件夹
mkdir c_proficient_road
cd c_proficient_road
# 新建C文件
touch vim_cmd.c
# 打开C文件
vim vim_cmd.c
```

使用 Vim 命令写一个基础程序，并保存，如下图。

![image-20250502145605785](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502145605785.png)

## 1.2 GCC

GCC（GNU Compiler Collection）是 [GNU](https://so.csdn.net/so/search?q=GNU&spm=1001.2101.3001.7020) 开源项目的一套开源编译器工具集，最初仅编译 C 语言，但现在的 GCC 支持编译 C++ 、Java、GO等多种编程语言，Linux内核就是采用 GCC 搭建的编译构建系统。

> **gcc** （GUN C Compiler）是GCC中的 c 编译器，而 **g++** （GUN C++ Compiler）是 GCC 中的 c++ 编译器。
>
> gcc 和 g++ 两者都可以编译 c 和 cpp 文件，但存在差异。gcc 在编译 cpp 时语法按照 c 来编译但默认不能链接到 c++ 的库（ gcc 默认链接 c 库， g++ 默认链接 c++ 库）。g++ 编译 <kbd>.c</kbd> 和 <kbd>.cpp</kbd> 文件都统一按 cpp 的语法规则来编译。所以一般编译 c 用 gcc ，编译 c++ 用 g++ 。

### 1.2.1 GCC安装

GCC 是 Linux 默认的 C/C++ 编译器，大部分 Linux 发行版都默认安装。若是需要手动安装，在终端执行以下命令安装：

```shell
# 更新软件包列表
sudo apt update

# 安装 GCC 及基础开发工具（包括 make、g++、libc-dev 等）
sudo apt install build-essential
```

验证 gcc 和 g++ 是否安装成功：

```shell
gcc -v
g++ -v
```

单独安装特定的 GCC 组件，如 g++、cmake等。

```shell
# 安装g++
sudo apt install g++
# 安装gdb
sudo apt install gdb
```

### 1.2.2 gcc编译器

gcc （GUN C Compiler）是 GCC 中的 c 编译器。

gcc 常用参数如下表：

| 参数名称 | 含义                                                   |
| -------- | ------------------------------------------------------ |
| `-o`     | 生成可执行文件                                         |
| `-E`     | 仅执行预处理（生成后缀为 `.i` 的预处理文件）           |
| `-S`     | 执行预处理和编译（生成后缀为 `.s` 的汇编文件）         |
| `-c`     | 执行预处理、编译和汇编（生成后缀为 `.o` 的二进制文件） |
|          |                                                        |
|          |                                                        |
|          |                                                        |

**基础编译**

编译命令格式：

```shell
# <input_name>是要编译的C文件名称
# <output_name>是生成的可执行文件的名称（默认名称为a.out/a.exe）
gcc <input_name> -o <output_name> 
```

编译命令示例：

```shell
# 编译vim_cmd.c
gcc vim_cmd.c -o vim_cmd
# 查看文件生成
ls
```

运行可执行文件：

```shell
./vim_cmd
```

![image-20250502152712701](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502152712701.png)



### 1.2.3 gdb调试器

GDB（GNU Project Debugger）是 GNU 项目开发的开源调试工具，支持 **C/C++** 、 **Fortran** 、 **Go**  等多种编程语言，主要用于检查程序运行状态、定位崩溃原因及分析逻辑错误。其核心功能包括：

- Start your program, specifying anything that might affect its behavior.（指定一些参数）
- Make your program stop on specified conditions.（断点）
- Examine what has happened, when your program has stopped.（分析crash现场）
- Change things in your program, so you can experiment with correcting the effects of one bug and go on to learn about another.（直接修改程序，看结果）

常用的 gdb 命令如下表，可以使用简写。

| 命令                | 缩写  | 功能                                                    | 示例                    |
| ------------------- | ----- | ------------------------------------------------------- | ----------------------- |
| `run`               | `r`   | 启动程序                                                | `run` 或 `r arg1`       |
| `break <行号>`      | `b`   | 设置断点                                                | `b 20` 或 `b file.c:15` |
| `next`              | `n`   | 单步执行（不进入函数）                                  | `n`                     |
| `step`              | `s`   | 单步执行（进入函数）                                    | `s`                     |
| `print <表达式>`    | `p`   | 打印变量值或表达式结果                                  | `p x` 或 `p &array[0]`  |
| `backtrace`         | `bt`  | 查看函数调用堆栈                                        | `bt`                    |
| `info locals`       |       | 显示当前函数的局部变量                                  | `info locals`           |
| `info breakpoints`  | `i b` | 列出所有断点                                            | `i b`                   |
| `delete <断点编号>` | `d`   | 删除断点                                                | `d 2`                   |
| `watch <变量>`      |       | 监视变量变化时暂停                                      | `watch x`               |
| `quit`              | `q`   | 退出 GDB                                                | `q`                     |
| `list <行号>`       |       | 展示指定行号上下各 5 行程序                             | `list 8`                |
| `diaplay <变量>`    |       | 监控变量变化，每次停下来都显示它的值**                  | `dispaly a`             |
| `undiaplay <变量>`  |       | 取消监控变量变化                                        | `undispaly a`           |
| `set var <表达式>`  |       | 修改变量的值                                            | `set var a=15`          |
| `until <行号>`      |       | ⭐进行指定位置跳转，执行完区间代码                       | `until 10`              |
| `finish`            |       | ⭐在一个函数内部，执行到当前函数返回，即快速跳出当前函数 | `finish`                |
| `continue`          | `c`   | ⭐继续执行到下一个断点                                   | `c`                     |

**修改程序**

> 在命令行模式输入命令`set nu`可以显示行数。

![image-20250502162041546](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502162041546.png)

**基础调试**

① 编译程序生成调试信息

使用 gdb 调试程序，需要在 gcc 编译时加上 `-g` 参数生成调试信息。

```shell
gcc vim_cmd.c -o vim_cmd -g
```

② 启动 gdb

以`vim_cmd.c`为例，启动 gdb 调试。

```shell
# vim_cmd为可执行文件，-q用于取消gdb的一些版本信息输出
gdb ./vim_cmd -q
```

启动 gdb 以后，会进入 gdb 的命令行环境，使用 gdb 的命令即可进行对应的调试工作，界面如下图所示：

![image-20250502162656352](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502162656352.png)

③ 查看程序

查看第 8 行左右的程序。

```shell
list 8
```

![image-20250502164202113](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502164202113.png)

④ 断点

在第 8 行打一个断点。

```shell
bread 8
```

![image-20250502164236053](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502164236053.png)

⑤ 运行

```shell
run
```

![image-20250502164342522](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502164342522.png)

⑥ 单步执行

```shell
next 
```

查看第 8 行运行前后，变量`a`的变化：

![image-20250502164530789](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502164530789.png)

⑦ 查看变量信息

基于变量查看信息：

```shell
# 查看地址
print &a
# 查看值(10进制)
print a
# 或 print/d a
# 查看值(16进制)
print/x a
# 查看值(2进制)
print/t a
```

![image-20250502171456909](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502171456909.png)

基于地址查看信息：

`examine`命令用于检查内存地址中的内容，缩写为`x`，支持多种显示格式和单位大小。

| **参数** | **功能**                                                     |
| :------- | :----------------------------------------------------------- |
| **数量** | 要显示的内存单元数量（默认为1）。                            |
| **格式** | `x`（十六进制）、`d`（十进制）、`u`（无符号十进制）、`t`（二进制）等。 |
| **单位** | `b`（字节）、`h`（半字，2字节）、`w`（字，4字节）、`g`（双字，8字节）。 |

具体格式如下：

```shell
x/[数量][格式][单位] <地址>
```

为了更直观的展示`examine`命令，修改程序，添加一个数组：

![image-20250502172305301](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502172305301.png)

重新编译并启动调试。

![image-20250502172352776](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502172352776.png)

基于数组可以直观看出数量、单位的含义：

- 数量：显示多少个内存单元的内容。
- 单位：单个内存单元的字节长度。

![image-20250502172537425](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502172537425.png)

⑧ 查看寄存器

```shell
info registers
```

![image-20250502173432090](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502173432090.png)

⑨ 反汇编

反汇编当前函数

```shell
# 完整指令disassemble
disas
```

![image-20250502173812077](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502173812077.png)

???note  
    更多命令可以在具体使用时再细细研究。

## 1.3 编译过程

使用 gcc 对`vim_cmd.c`文件进行编译时，并非直接生成可执行文件，中间还经历了预处理、编译和汇编等过程，同时gcc 也提供了生成中间文件的命令，可以帮助我们更好的了解编译过程。

![image-20250502233443183](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502233443183.png)

### 1.3.3 预处理

预处理过程主要进行 **头文件包含** 、 **宏定义替换** 处理，最后生成`.i`后缀的文件。

修改程序，添加一个宏定义并赋值给变量`a`，然后执行 gcc 命令生成预处理文件`vim_cmd.i`：

```shell
gcc vim_cmd.c -o vim_cmd.i -E
```

打开`vim_cmd.i`文件，可以看到调用的头文件被包含进来，并替换了宏常量和宏代码段。

![image-20250502235629844](https://tonmoon.obs.cn-east-3.myhuaweicloud.com/img/tonmoon/image-20250502235629844.png)